# Minimal Electron Builder Configuration - Fast builds
# Only includes runtime dependencies, not 2.2GB of dev tools

appId: com.arus.marine.monitoring
productName: ARUS Marine Monitoring
copyright: Copyright Â© 2025 ARUS

directories:
  buildResources: electron/build
  output: dist/electron

# Only include Electron wrapper code
files:
  - electron/main.js
  - electron/preload.js
  - electron/icon.png
  - package.json
  - "!**/*"

# Server code + minimal runtime dependencies
extraResources:
  # Built server code
  - from: "dist/index.js"
    to: "app/dist/index.js"
  
  # Package.json for app
  - from: "electron/app-package/package.json"
    to: "app/package.json"
  
  # ONLY runtime dependencies (not all 2.2GB!)
  # We'll install these separately in the build
  - from: "node_modules/@libsql"
    to: "app/node_modules/@libsql"
  - from: "node_modules/@neondatabase"
    to: "app/node_modules/@neondatabase"
  - from: "node_modules/better-sqlite3"
    to: "app/node_modules/better-sqlite3"
  - from: "node_modules/drizzle-orm"
    to: "app/node_modules/drizzle-orm"
  - from: "node_modules/express"
    to: "app/node_modules/express"
  - from: "node_modules/@tensorflow"
    to: "app/node_modules/@tensorflow"
  - from: "node_modules/@serialport"
    to: "app/node_modules/@serialport"
  - from: "node_modules/serialport"
    to: "app/node_modules/serialport"

# macOS Configuration
mac:
  category: public.app-category.productivity
  target: tar.gz
  hardenedRuntime: false
  gatekeeperAssess: false
  extraResources:
    - from: "electron/nodejs"
      to: "nodejs"

# Compression
compression: normal
asar: true
asarUnpack:
  - node_modules/@libsql/**/*
  - node_modules/better-sqlite3/**/*
