#!/usr/bin/env bash
# ARUS Marine - Universal Installer
# Auto-detects OS and runs appropriate installation

set -e

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   ARUS Marine Installation System         â•‘"
echo "â•‘   Predictive Maintenance Platform          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"

# Detect operating system
detect_os() {
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        OS="linux"
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        OS="macos"
    elif [[ "$OSTYPE" == "cygwin" ]] || [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "win32" ]]; then
        OS="windows"
    else
        OS="unknown"
    fi
}

detect_os

echo -e "${BLUE}ðŸ” Detected Operating System: ${GREEN}$OS${NC}\n"

# Run appropriate installer based on OS
case $OS in
    "linux"|"macos")
        echo -e "${GREEN}âœ“ Running Unix/Linux installer...${NC}\n"
        if [ -f "./install.sh" ]; then
            chmod +x ./install.sh
            ./install.sh
        else
            echo -e "${RED}âœ— Error: install.sh not found${NC}"
            exit 1
        fi
        ;;
    "windows")
        echo -e "${GREEN}âœ“ Detected Windows (Git Bash/WSL/Cygwin)${NC}\n"
        echo -e "${YELLOW}Please run the Windows installer directly:${NC}"
        echo ""
        echo -e "${BLUE}Option 1 - Command Prompt/PowerShell:${NC}"
        echo "  install.bat"
        echo ""
        echo -e "${BLUE}Option 2 - From this shell:${NC}"
        echo "  cmd.exe //c install.bat    (if cmd.exe is in PATH)"
        echo ""
        echo -e "${YELLOW}Note: The Windows installer requires Command Prompt or PowerShell${NC}"
        echo -e "${YELLOW}to properly install Node.js if missing.${NC}"
        echo ""
        
        # Try to run it anyway if cmd.exe is available
        if command -v cmd.exe &> /dev/null; then
            echo -e "${GREEN}âœ“ Attempting to run Windows installer via cmd.exe...${NC}\n"
            cmd.exe //c install.bat
        else
            echo -e "${RED}âœ— cmd.exe not found in PATH${NC}"
            echo -e "${YELLOW}Please open Command Prompt or PowerShell and run: install.bat${NC}"
            exit 1
        fi
        ;;
    "unknown")
        echo -e "${RED}âœ— Error: Could not detect your operating system${NC}"
        echo -e "${YELLOW}Please run the installer manually:${NC}"
        echo "  - macOS/Linux: ./install.sh"
        echo "  - Windows: install.bat (in Command Prompt/PowerShell)"
        exit 1
        ;;
esac
